<!DOCTYPE html>
<html>
<head>
    <title>Chat Server</title>
    <link id="stylesheet" rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dark-mode-toggle.css">
    <script src="js/jquery.min.js"></script>
</head>
<body style="max-width:300px">
    <!-- Light/Dark Toggle -->
    <label class="ui-switch">
        <input type="checkbox" id="dark-mode-toggle">
        <div class="slider">
          <div class="circle"></div>
        </div>
    </label>
    <!-- / Light/Dark Toggle -->

    <h1>Chat Server</h1>
    <div id="chat"></div>
    <input type="text" id="message" placeholder="Type your message here" onkeydown="handleKeyDown(event)">
    <button id="send">Send</button>

    <script>
        $("#dark-mode-toggle").change(toggleDarkMode);

        function toggleDarkMode(){
            var stylesheet = document.getElementById('stylesheet');
            if (stylesheet.getAttribute('href') === 'css/style.css') {
                stylesheet.setAttribute('href', 'css/style.dark.css');
            } else {
                stylesheet.setAttribute('href', 'css/style.css');
            }
        }

        function handleKeyDown(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            $("#message").attr("disabled", true);
            $("#send").attr("disabled", true);
            var message = $("#message").val();
            $("#chat").append(`<div class="bubble user-bubble">${message}</div>`);
            $("#chat").append(`<div class="loader"></div>`);

            $.get(`/api/chat?prompt=${message}`, function(data, status){
                $(".loader").remove();
                $("#chat").append(`<div class="bubble speech-bubble">${data}</div>`);
                $("#message").val('');
                $("#message").attr("disabled", false);
                $("#send").attr("disabled", false);
            }).fail(function(){
                $(".loader").remove();
                $("#chat").append(`<div class="bubble speech-bubble">Server error</div>`);
                $("#message").attr("disabled", false);
                $("#send").attr("disabled", false);
            });            
        }

        $(document).ready(function(){
            $("#send").click(sendMessage);
            $("#dark-mode-toggle").click();
        });
    </script>
   
</body>
</html>
